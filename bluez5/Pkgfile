# Description: Bluetooth libraries and utilities
# URL: https://www.bluez.org/
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: alsa-lib dbus glib libical

name=bluez5
version=5.50
release=2
source=(https://mirrors.edge.kernel.org/pub/linux/bluetooth/bluez-$version.tar.xz bluetoothd)

build() {
  cd bluez-$version

  [[ -e /usr/lib/cups ]] && PKGMK_BLUEZ+=" --enable-cups" || PKGMK_BLUEZ+=" --disable-cups"

  ./configure $PKGMK_BLUEZ \
    --prefix=/usr \
    --sysconfdir=/etc \
    --localstatedir=/var \
    --libexecdir=/usr/lib/$name \
    --enable-tools \
    --enable-test \
    --enable-midi \
    --enable-experimental \
    --enable-a2dp \
    --enable-library \
    --disable-systemd

  make
  make DESTDIR=$PKG all install

  make DESTDIR=$PKG \
    install-includeHEADERS \
    install-libLTLIBRARIES \
    install-pkgconfigDATA

  # install init script
  install -D -m 755 $SRC/bluetoothd \
    $PKG/etc/rc.d/bluetoothd
}
