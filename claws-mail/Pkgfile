# Description: An e-mail client (and news reader), based on GTK+
# URL: https://www.claws-mail.org
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: gtk libetpan gpgme gnutls libical networkmanager

name=claws-mail
version=3.17.4
release=1
source=(http://www.claws-mail.org/releases/$name-$version.tar.xz)

build() {
    cd $name-$version

    NM_CFLAGS="-I/usr/include/libnm"
    sed -i "s:PKG_CHECK_MODULES(ENCHANT, enchant >= 1.4.0:PKG_CHECK_MODULES(ENCHANT, enchant-2 >= 1.4.0:" configure.ac
    sed -i "s:--cflags enchant:--cflags enchant-2:" configure.ac
    autoreconf -vfi
    sed -i 's@^#!.*python.*@#!/usr/bin/python2@' tools/*.py
    sed -i 's:python -c:python2 -c:g' configure

    ./configure \
        --prefix=/usr \
        --enable-gnutls \
        --enable-alternate-addressbook \
        --with-config-dir=.config/claws-mail \
        --disable-manual \
        --disable-static \
        --disable-nls \
        --disable-maintainer-mode \
        --disable-valgrind

    sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool

    make
    make DESTDIR=$PKG install

    rm -rf $PKG/usr/share/doc
}
