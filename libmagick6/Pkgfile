# Description: version6 of the imagemagick library
# URL: https://legacy.imagemagick.org/
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: avahi ghostscript graphite2 lcms2 libidn librsvg libtool libwebp zstd

name=libmagick6
version=6.9.10-27
release=1
source=(https://www.imagemagick.org/download/ImageMagick-6.9.10-27.tar.xz IM6-GS-policy.patch)

build() {
	cd ImageMagick-$version
    patch -p1 -i ../IM6-GS-policy.patch
    ./configure \
            PKG_CONFIG="/usr/bin/env PKG_CONFIG_PATH=/usr/lib/imagemagick6/pkgconfig pkg-config" \
            --prefix=/usr \
            --with-dejavu-font-dir=/usr/share/fonts/TTF \
            --with-gs-font-dir=/usr/share/fonts/gsfonts \
            PSDelegate=/usr/bin/gs \
            XPSDelegate=/usr/bin/gxps \
            PCLDelegate=/usr/bin/gpcl6 \
            --enable-hdri \
            --enable-opencl \
            --with-gslib \
            --with-lqr \
            --with-modules \
            --with-openexr \
            --with-openjp2 \
            --with-perl \
            --with-perl-options=INSTALLDIRS=vendor \
            --with-rsvg \
            --with-webp \
            --with-wmf \
            --with-xml \
            --without-autotrace \
            --without-djvu \
            --without-dps \
            --without-fftw \
            --without-fpx \
            --without-gcc-arch \
            --without-gvc
     sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
     make
     make DESTDIR=$PKG install pkgconfigdir="/usr/lib/imagemagick6/pkgconfig"
#     rm $PKG/usr/etc/ImageMagick-$version/type-{apple,urw-base35,windows}.xml
rm $PKG/usr/{bin,share/man,share/doc,lib/perl5} -fr

rm $PKG/usr/lib/*.la

     # Split 'imagemagick'
     #cd ../binpkg
     #mv "$pkgdir/usr/bin" usr/
     #mv "$pkgdir/usr/lib/perl5" usr/lib/
     #mv "$pkgdir/usr/share/man" usr/share/
}
