# Description: Tiny, lightning fast, feature-packed file manager
# URL: https://github.com/jarun/nnn
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: ncurses readline
# Optional: patool mediainfo

name=nnn
version=2.5
release=1
source=(https://github.com/jarun/nnn/releases/download/v$version/$name-v$version.tar.gz)

build() {
  cd $name
  sed -i 's/install: all/install:/' Makefile
  make
  make DESTDIR=$PKG PREFIX=/usr install
  mkdir $PKG/usr/share/nnn

  # install auto-completion files if installed
  if [ -e /lib/zsh ]; then
    install -Dm644 scripts/auto-completion/zsh/_nnn $PKG/usr/share/zsh/site-functions/_nnn
  fi
  if [ -e /usr/share/bash-completion ]; then
    install -Dm644 scripts/auto-completion/bash/nnn-completion.bash $PKG/usr/share/bash-completion/completions/nnn
  fi
  # fish is not in core/opt/contrib so I'll ignore it
  # install provided scripts and plugins to $PKG/usr/share
  pushd scripts
  for i in $(find . -type d ! -name auto-completion ! -name zsh ! -name bash ! -name fish | xargs) ; do
    cp -r $i $PKG/usr/share/nnn;
  done
  popd
  mv plugins $PKG/usr/share/nnn
  find $PKG -name README.md -delete
}
