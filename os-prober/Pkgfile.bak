# Description: utility to detect other OSes on a set of drives
# URL: http://joeyh.name/code/os-prober/
# Maintainer:
# Depends on: 

name=os-prober
version=1.76
release=2
source=(http://http.debian.net/debian/pool/main/o/os-prober/os-prober_1.76.tar.xz Fix-CRUX-grub-menu-entry-detection.patch)

build() {
	cd $name-$version
    patch -Np1 -i $SRC/Fix-CRUX-grub-menu-entry-detection.patch
    sed -i -e "s:/lib/ld\*\.so\*:/lib*/ld*.so*:g" os-probes/mounted/common/90linux-distro
    rm -f Makefile
    make newns
    install -Dm755 linux-boot-prober "$PKG"/usr/bin/linux-boot-prober
    install -Dm755 os-prober "$PKG"/usr/bin/os-prober
    install -Dm755 newns "$PKG"/usr/lib/os-prober/newns
    install -Dm755 common.sh $PKG/usr/share/os-prober/common.sh
    
    for dir in os-probes os-probes/mounted os-probes/init; do
    install -dm755 "$PKG/usr/lib/$dir"
    install -m755 -t "$PKG/usr/lib/$dir" "$dir"/common/*
    [[ -d "$dir"/x86 ]] && cp -r "$dir"/x86/* "$PKG/usr/lib/$dir"
    done
    
    install -Dm755 os-probes/mounted/powerpc/20macosx "$PKG"/usr/lib/os-probes/mounted/20macosx
    install -dm755 "$PKG"/var/lib/os-prober
}
