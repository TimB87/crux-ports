# Description: Perl extension for using OpenSSL
# URL: https://search.cpan.org/dist/Net-SSLeay/
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: chrpath

name=p5-net-ssleay
version=1.85
release=1
source=(https://www.cpan.org/authors/id/M/MI/MIKEM/Net-SSLeay-$version.tar.gz)

build() {
  cd Net-SSLeay-$version
  sed -i -e "/\$opts->{optimize} = '-O2 -g';/d" \
      inc/Module/Install/PRIVATE/Net/SSLeay.pm
  export OPENSSL_PREFIX=/usr
  export OPTIMIZE="${CFLAGS}"
  PERL_MM_USE_DEFAULT=1 perl Makefile.PL INSTALLDIRS=vendor
  make
  make install DESTDIR=$PKG
  find $PKG -name '*.so' -exec chrpath -d '{}' \;
  find $PKG \( -name '.packlist' -o -name '*.pod' \) -delete
}
