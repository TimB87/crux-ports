# Description: CGI/FastCGI version of the PHP interpreter
# URL: http://www.php.net
# Maintainer: Tim Biermann, tbier at posteo dot de
# Packager: Juergen Daubert, jue at crux dot nu
# Depends on: libpcre2 libxml2

name=php-fcgi
version=7.3.9
release=1
source=(http://php.net/distributions/php-$version.tar.xz
  php-fcgi)

build () {
  cd php-$version

  CPPFLAGS+=' -DU_USING_ICU_NAMESPACE=1'

  local PHP_CONFIG="
  --prefix=/usr \
  --with-layout=GNU \
  --with-config-file-path=/etc/php \
  --with-config-file-scan-dir=/etc/php/conf.d \
  --with-zlib \
  --with-pcre-regex=/usr \
  --disable-rpath \
  --disable-static --disable-debug \
  --without-sqlite3 --without-pdo-sqlite \
  --without-pear"

  EXTENSION_DIR=/usr/lib/php/extensions \
  ./configure \
    $PHP_CONFIG \
    --disable-cli \
    --enable-cgi \
    --with-readline \
    --enable-embed=shared

  make
  make -j1 INSTALL_ROOT=$PKG install-cgi
  install -D -m 755 sapi/cgi/php-cgi $PKG/usr/bin/php-cgi
  install -D -m 755 $SRC/php-fcgi $PKG/etc/rc.d/php-fcgi
}
